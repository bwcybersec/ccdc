---
- name: splunk tasks
  hosts: splunk 
  become: true

  tasks:
    - name: set splunk hostname
      shell: echo "splunk01.{{ domain }}" > /etc/hostname
      args:
        executable: /bin/bash

    - name: set env
      shell: | 
        echo "ZDS_TYPE=splunk" >> /etc/profile
        echo "SPLUNK_HOME=/opt/splunk" >> /etc/profile
      args:
        executable: /bin/bash 

    - name: install packages
      package: 
        name:
          - git
          - curl
          - vim
          - net-snmp
          - net-snmp-utils
          - nmap
          - nmap-ncat
          - tcpdump
          - audit
          - chrony
          - xdp-tools
          - lynis
          - lsof
          - tmux
          - gdb
          - htop
        state: latest

    - name: reinstall packages
      shell: dnf reinstall -y pam openssh-server coreutils
      args:
        executable: /bin/bash

    - name: disable firewall
      shell: |
        systemctl stop --now firewalld
        systemctl disable firewalld
      args:
        executable: /bin/bash

    - name: fetch splunkzds
      shell: |
        cd {{ zds_dir }}
        curl -o splunkzds "{{ zangoose }}"
        chmod +x splunkzds
      args:
        executable: /bin/bash

