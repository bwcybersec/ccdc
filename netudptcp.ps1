$TCPConns = Get-NetTCPConnection | Where-Object State -eq Listen | ForEach {$Process = Get-Process -Id $_.OwningProcess; Add-Member -PassThru -InputObject $_ -NotePropertyName "ProcessName" -NotePropertyValue $Process.Name} | Select-Object LocalAddress, LocalPort, RemoteAddress, RemotePort, State, OwningProcess, ProcessName
$UDPConns = Get-NetUDPEndpoint | ForEach {$Process = Get-Process -Id $_.OwningProcess; Add-Member -PassThru -InputObject $_ -NotePropertyName "ProcessName" -NotePropertyValue $Process.Name} | Select-Object LocalAddress, LocalPort, RemoteAddress, RemotePort, State, OwningProcess, ProcessName
$TCPConns + $UDPConns | ForEach {Add-Member -PassThru -InputObject $_ -NotePropertyName "Protocol" -NotePropertyValue $(If ($_.State -eq "Listen") {"TCP"} Else {"UDP"})} | Format-Table